<beans xmlns:jpa="http://www.springframework.org/schema/data/jpa"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jdbc="http://www.springframework.org/schema/jdbc"
       xmlns:tx="http://www.springframework.org/schema/tx" xmlns="http://www.springframework.org/schema/beans"

       xsi:schemaLocation="http://www.springframework.org/schema/jdbc
        http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/data/jpa
        http://www.springframework.org/schema/data/jpa/spring-jpa.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">


    <beans profile="staging,dev,prod,production">
        <!-- Configures the database connection. -->
        <bean id="hikariConfig" class="com.zaxxer.hikari.HikariConfig">
            <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
            <property name="jdbcUrl" value="${register.data.url}"/>
            <property name="username" value="${register.data.username}"/>
            <property name="password" value="${register.data.password}"/>
        </bean>

        <!-- Creates the datasource bean. -->
        <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource">
            <constructor-arg index="0" ref="hikariConfig"/>
        </bean>

        <bean id="jpaAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
            <!--<property templateName="database" value="HSQL"/>-->
            <!--<property templateName="databasePlatform" value="org.hibernate.dialect.HSQLDialect"/>-->
            <property name="database" value="MYSQL"/>
            <property name="databasePlatform" value="org.hibernate.dialect.MySQL57InnoDBDialect"/>
            <property name="showSql" value="true" />
        </bean>
    </beans>

    <beans>
        <jpa:repositories base-package="com.topspectrum.feedback.register.data.repositories" transaction-manager-ref="transactionManager" />
        <jpa:repositories base-package="feedback.web.data.repositories" transaction-manager-ref="transactionManager" />
        <jpa:repositories base-package="com.topspectrum.data.dao" transaction-manager-ref="transactionManager" />
        <!--<jpa:repositories base-package="feedback.register.web.controllers.whois.data" transaction-manager-ref="transactionManager" />-->
        <jpa:repositories base-package="feedback.register.web.controllers.whois" transaction-manager-ref="transactionManager" />

        <jpa:auditing auditor-aware-ref="springSecurityAuditorAwareBean" modify-on-creation="true" set-dates="true"/>

        <!-- For autowiring. -->
        <bean class="feedback.jpa.ContextHelper"/>

        <bean class="feedback.web.data.DefaultJpaContextHelper"/>

        <bean class="org.springframework.transaction.support.TransactionTemplate">
            <property name="transactionManager" ref="transactionManager"/>
            <!--PROPAGATION_REQUIRES_NEW-->
            <property name="propagationBehavior" value="3"/>
        </bean>

        <bean id="springSecurityAuditorAwareBean" class="feedback.web.data.SpringSecurityAuditorAwareBean"/>

        <bean id="jpaDialect" class="org.springframework.orm.jpa.vendor.HibernateJpaDialect" />

        <tx:annotation-driven transaction-manager="transactionManager" />

        <bean id="entityManagerFactory"
              class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
            <property name="persistenceXmlLocation" value="classpath:META-INF/persistence.xml" />
            <property name="persistenceUnitName" value="default" />
            <property name="dataSource" ref="dataSource" />
            <property name="jpaVendorAdapter" ref="jpaAdapter" />
            <property name="jpaDialect" ref="jpaDialect" />
            <property name="validationMode" value="NONE"/>
        </bean>

        <!--
            Creates the transaction manager bean that integrates the used JPA provider with the
            Spring transaction mechanism.
        -->
        <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
            <property name="dataSource" ref="dataSource"/>
            <property name="entityManagerFactory" ref="entityManagerFactory" />
            <property name="jpaDialect" ref="jpaDialect" />
        </bean>

        <!-- Enables annotation-driven transaction management. -->
        <!--<tx:annotation-driven/>-->

        <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
            <property name="dataSource" ref="dataSource"/>
        </bean>
    </beans>
</beans>